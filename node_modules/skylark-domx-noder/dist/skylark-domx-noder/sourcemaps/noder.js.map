{"version":3,"sources":["noder.js"],"names":["define","skylark","langx","scripter","browser","isIE","navigator","userAgent","match","fragmentRE","singleTagRE","div","document","createElement","table","tableBody","tableRow","containers","tr","tbody","thead","tfoot","td","th","*","rootNodeRE","map","Array","prototype","slice","ensureNodes","content","copyByClone","nodes","call","isArrayLike","value","isElement","isTextNode","test","createTextNode","filter","normalizeContent","node","cloneNode","flatten","nodeName","elm","chkName","name","toLowerCase","undefined","enhancePlaceContent","placing","isFunction","apply","neddsFlattern","i","length","append","parentNode","appendChild","this","tag","props","attrs","parent","createElementNS","isHtmlNode","setAttribute","empty","hasChildNodes","child","firstChild","removeChild","fullscreen","el","exitFullscreen","support","requestFullscreen","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","rxhtmlTag","isChildOf","directly","documentElement","contains","nodeType","ownerDoc","ownerDocument","isEditable","contentEditable","noder","mixin","active","doc","activeElement","error","body","after","refNode","nextSibling","insertBefore","before","blur","clone","deep","self","each","getAttribs","attr","setAttrib","getAttrib","contents","contentDocument","childNodes","createFragment","html","trim","RegExp","$1","container","innerHTML","xml","split","newXml","edsplit","removeSelfClosingTags","dom","forEach","text","generateId","str","tagName","className","src","href","textContent","sum","charCodeAt","toString","focusable","element","hasTabindex","mapName","img","focusableIfVisible","fieldset","$","is","disabled","closest","visible","fromPoint","x","y","elementFromPoint","result","isString","replace","isNumber","_html","scripts","querySelectorAll","node1","rscriptType","type","evaluate","isActive","elem","isDocument","DOCUMENT_NODE","isFullscreen","isInDocument","isInFrame","window","isInput","isWindow","offsetParent","defaultView","getComputedStyle","position","ownerWindow","parentWindow","prepend","reflow","offsetHeight","remove","e","console","warn","children","oldNode","replaceChild","selectable","style","onselectstart","MozUserSelect","KhtmlUserSelect","unselectable","traverse","fn","len","reverse","wrapper","wrapperNode","wrapperInner","unwrap","isDoc","attach"],"mappings":"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","file":"../noder.js","sourcesContent":["define([\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-langx-scripter\",\r\n    \"skylark-domx-browser\"\r\n], function(skylark, langx, scripter,browser) {\r\n    var isIE = !!navigator.userAgent.match(/Trident/g) || !!navigator.userAgent.match(/MSIE/g),\r\n        fragmentRE = /^\\s*<(\\w+|!)[^>]*>/,\r\n        singleTagRE = /^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,\r\n        div = document.createElement(\"div\"),\r\n        table = document.createElement('table'),\r\n        tableBody = document.createElement('tbody'),\r\n        tableRow = document.createElement('tr'),\r\n        containers = {\r\n            'tr': tableBody,\r\n            'tbody': table,\r\n            'thead': table,\r\n            'tfoot': table,\r\n            'td': tableRow,\r\n            'th': tableRow,\r\n            '*': div\r\n        },\r\n        rootNodeRE = /^(?:body|html)$/i,\r\n        map = Array.prototype.map,\r\n        slice = Array.prototype.slice;\r\n\r\n\r\n\r\n    function normalizeContent(content) {\r\n        if (typeof content === 'function') {\r\n            content = content();\r\n        }\r\n        return map.call(langx.isArrayLike(content) ? content : [content],value => {\r\n            if (typeof value === 'function') {\r\n                value = value();\r\n            }\r\n            if (isElement(value) || isTextNode(value)) {\r\n                return value;\r\n            }\r\n            if (typeof value === 'string' && /\\S/.test(value)) {\r\n                return document.createTextNode(value);\r\n            }\r\n        }).filter(value => value);\r\n    }\r\n\r\n    function ensureNodes(content, copyByClone) {\r\n        var nodes = normalizeContent(content);\r\n\r\n\r\n        //if (!langx.isArrayLike(nodes)) {\r\n        //    nodes = [nodes];\r\n        //}\r\n        if (copyByClone) {\r\n            nodes = map.call(nodes, function(node) {\r\n                return node.cloneNode(true);\r\n            });\r\n        }\r\n        return langx.flatten(nodes);\r\n    }\r\n\r\n    function nodeName(elm, chkName) {\r\n        var name = elm.nodeName && elm.nodeName.toLowerCase();\r\n        if (chkName !== undefined) {\r\n            return name === chkName.toLowerCase();\r\n        }\r\n        return name;\r\n    };\r\n\r\n\r\n    function activeElement(doc) {\r\n        doc = doc || document;\r\n        var el;\r\n\r\n        // Support: IE 9 only\r\n        // IE9 throws an \"Unspecified error\" accessing document.activeElement from an <iframe>\r\n        try {\r\n            el = doc.activeElement;\r\n        } catch ( error ) {\r\n            el = doc.body;\r\n        }\r\n\r\n        // Support: IE 9 - 11 only\r\n        // IE may return null instead of an element\r\n        // Interestingly, this only seems to occur when NOT in an iframe\r\n        if ( !el ) {\r\n            el = doc.body;\r\n        }\r\n\r\n        // Support: IE 11 only\r\n        // IE11 returns a seemingly empty object in some cases when accessing\r\n        // document.activeElement from an <iframe>\r\n        if ( !el.nodeName ) {\r\n            el = doc.body;\r\n        }\r\n\r\n        return el;\r\n    };\r\n\r\n    function enhancePlaceContent(placing,node) {\r\n        if (langx.isFunction(placing)) {\r\n            return placing.apply(node,[]);\r\n        }\r\n        if (langx.isArrayLike(placing)) {\r\n            var neddsFlattern;\r\n            for (var i=0;i<placing.length;i++) {\r\n                if (langx.isFunction(placing[i])) {\r\n                    placing[i] = placing[i].apply(node,[]);\r\n                    if (langx.isArrayLike(placing[i])) {\r\n                        neddsFlattern = true;\r\n                    }\r\n                }\r\n            }\r\n            if (neddsFlattern) {\r\n                placing = langx.flatten(placing);\r\n            }\r\n        }\r\n        return placing;\r\n    }\r\n    function after(node, placing, copyByClone) {\r\n        placing = enhancePlaceContent(placing,node);\r\n        var refNode = node,\r\n            parent = refNode.parentNode;\r\n        if (parent) {\r\n            var nodes = ensureNodes(placing, copyByClone),\r\n                refNode = refNode.nextSibling;\r\n\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (refNode) {\r\n                    parent.insertBefore(nodes[i], refNode);\r\n                } else {\r\n                    parent.appendChild(nodes[i]);\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    function append(node, placing, copyByClone) {\r\n        placing = enhancePlaceContent(placing,node);\r\n        var parentNode = node,\r\n            nodes = ensureNodes(placing, copyByClone);\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            parentNode.appendChild(nodes[i]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    function before(node, placing, copyByClone) {\r\n        placing = enhancePlaceContent(placing,node);\r\n        var refNode = node,\r\n            parent = refNode.parentNode;\r\n        if (parent) {\r\n            var nodes = ensureNodes(placing, copyByClone);\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                parent.insertBefore(nodes[i], refNode);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /*   \r\n     * Get the children of the specified node, including text and comment nodes.\r\n     * @param {HTMLElement} elm\r\n     */\r\n    function contents(elm) {\r\n        if (nodeName(elm, \"iframe\")) {\r\n            return elm.contentDocument;\r\n        }\r\n        return elm.childNodes;\r\n    }\r\n\r\n    /*   \r\n     * Create a element and set attributes on it.\r\n     * @param {HTMLElement} tag\r\n     * @param {attrs} attrs\r\n     * @param } parent\r\n     */\r\n    function createElement(tag, props,attrs, parent) {\r\n        var node;\r\n\r\n        if (/svg/i.test(tag)) {\r\n            node = document.createElementNS(\"http://www.w3.org/2000/svg\", tag)\r\n        } else {\r\n            node = document.createElement(tag);\r\n        }\r\n\r\n        if (langx.isHtmlNode(props)) {\r\n            parent = props;\r\n            props = null;\r\n            attrs = null;\r\n        } else if (langx.isHtmlNode(attrs)){\r\n            parent = attrs;\r\n            attrs = null;\r\n        }\r\n\r\n        if (props) {\r\n            for (var name in props) {\r\n                node[name] = props[name];\r\n            }\r\n        }\r\n\r\n        if (attrs) {\r\n            for (var name in attrs) {\r\n                node.setAttribute(name, attrs[name]);\r\n            }\r\n        }\r\n        if (parent) {\r\n            append(parent, node);\r\n        }\r\n        return node;\r\n    }\r\n\r\nfunction removeSelfClosingTags(xml) {\r\n    var split = xml.split(\"/>\");\r\n    var newXml = \"\";\r\n    for (var i = 0; i < split.length - 1;i++) {\r\n        var edsplit = split[i].split(\"<\");\r\n        newXml += split[i] + \"></\" + edsplit[edsplit.length - 1].split(\" \")[0] + \">\";\r\n    }\r\n    return newXml + split[split.length-1];\r\n}\r\n\r\n    /*   \r\n     * Create a DocumentFragment from the HTML fragment.\r\n     * @param {String} html\r\n     */\r\n    function createFragment(html) {\r\n        // A special case optimization for a single tag\r\n        html = langx.trim(html);\r\n        if (singleTagRE.test(html)) {\r\n            return [createElement(RegExp.$1)];\r\n        }\r\n\r\n        var name = fragmentRE.test(html) && RegExp.$1\r\n        if (!(name in containers)) {\r\n            name = \"*\"\r\n        }\r\n        var container = containers[name];\r\n        container.innerHTML = removeSelfClosingTags(\"\" + html);\r\n        dom = slice.call(container.childNodes);\r\n\r\n        dom.forEach(function(node) {\r\n            container.removeChild(node);\r\n        })\r\n\r\n        return dom;\r\n    }\r\n\r\n    /*   \r\n     * Create a deep copy of the set of matched elements.\r\n     * @param {HTMLElement} node\r\n     * @param {Boolean} deep\r\n     */\r\n    function clone(node, deep) {\r\n        var self = this,\r\n            clone;\r\n\r\n        // TODO: Add feature detection here in the future\r\n        if (!isIE || node.nodeType !== 1 || deep) {\r\n            return node.cloneNode(deep);\r\n        }\r\n\r\n        // Make a HTML5 safe shallow copy\r\n        if (!deep) {\r\n            clone = document.createElement(node.nodeName);\r\n\r\n            // Copy attribs\r\n            each(self.getAttribs(node), function(attr) {\r\n                self.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\r\n            });\r\n\r\n            return clone;\r\n        }\r\n    }\r\n\r\n    /*   \r\n     * Check to see if a dom node is a descendant of another dom node .\r\n     * @param {String} node\r\n     * @param {Node} child\r\n     */\r\n    function contains(node, child) {\r\n        return isChildOf(child, node);\r\n    }\r\n\r\n    /*   \r\n     * Create a new Text node.\r\n     * @param {String} text\r\n     * @param {Node} child\r\n     */\r\n    function createTextNode(text) {\r\n        return document.createTextNode(text);\r\n    }\r\n\r\n    /*   \r\n     * Get the current document object.\r\n     */\r\n    function doc() {\r\n        return document;\r\n    }\r\n\r\n    /*   \r\n     * Remove all child nodes of the set of matched elements from the DOM.\r\n     * @param {Object} node\r\n     */\r\n    function empty(node) {\r\n        while (node.hasChildNodes()) {\r\n            var child = node.firstChild;\r\n            node.removeChild(child);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    var fulledEl = null;\r\n\r\n    function fullscreen(el) {\r\n        if (el === false) {\r\n            return browser.exitFullscreen.apply(document);\r\n        } else if (el) {\r\n            return el[browser.support.fullscreen.requestFullscreen]();\r\n            fulledEl = el;\r\n        } else {\r\n            return (\r\n                document.fullscreenElement ||\r\n                document.webkitFullscreenElement ||\r\n                document.mozFullScreenElement ||\r\n                document.msFullscreenElement\r\n            )\r\n        }\r\n    }\r\n\r\n    function isFullscreen(el) {\r\n        return fullscreen() === el;\r\n    }\r\n\r\n\r\n    // Selectors\r\n    function focusable( element, hasTabindex ) {\r\n        var map, mapName, img, focusableIfVisible, fieldset,\r\n            nodeName = element.nodeName.toLowerCase();\r\n\r\n        if ( \"area\" === nodeName ) {\r\n            map = element.parentNode;\r\n            mapName = map.name;\r\n            if ( !element.href || !mapName || map.nodeName.toLowerCase() !== \"map\" ) {\r\n                return false;\r\n            }\r\n            img = $( \"img[usemap='#\" + mapName + \"']\" );\r\n            return img.length > 0 && img.is( \":visible\" );\r\n        }\r\n\r\n        if ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {\r\n            focusableIfVisible = !element.disabled;\r\n\r\n            if ( focusableIfVisible ) {\r\n\r\n                // Form controls within a disabled fieldset are disabled.\r\n                // However, controls within the fieldset's legend do not get disabled.\r\n                // Since controls generally aren't placed inside legends, we skip\r\n                // this portion of the check.\r\n                fieldset = $( element ).closest( \"fieldset\" )[ 0 ];\r\n                if ( fieldset ) {\r\n                    focusableIfVisible = !fieldset.disabled;\r\n                }\r\n            }\r\n        } else if ( \"a\" === nodeName ) {\r\n            focusableIfVisible = element.href || hasTabindex;\r\n        } else {\r\n            focusableIfVisible = hasTabindex;\r\n        }\r\n\r\n        return focusableIfVisible && $( element ).is( \":visible\" ) && visible( $( element ) );\r\n    };\r\n\r\n    function fromPoint(x,y) {\r\n        return document.elementFromPoint(x,y);\r\n    }\r\n\r\n    /**\r\n     * Generate id\r\n     * @param   {HTMLElement} el\r\n     * @returns {String}\r\n     * @private\r\n     */\r\n    function generateId(el) {\r\n        var str = el.tagName + el.className + el.src + el.href + el.textContent,\r\n            i = str.length,\r\n            sum = 0;\r\n\r\n        while (i--) {\r\n            sum += str.charCodeAt(i);\r\n        }\r\n\r\n        return sum.toString(36);\r\n    }\r\n\r\n\r\n   var rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi;\r\n \r\n    /*   \r\n     * Get the HTML contents of the first element in the set of matched elements.\r\n     * @param {HTMLElement} node\r\n     * @param {String} html\r\n     */\r\n    function _html(node, html) {\r\n        if (html === undefined) {\r\n            return node.innerHTML;\r\n        } else {\r\n            empty(node);\r\n            html = html || \"\";\r\n            if (langx.isString(html)) {\r\n                html = html.replace( rxhtmlTag, \"<$1></$2>\" );\r\n            }\r\n            if (langx.isString(html) || langx.isNumber(html)) {               \r\n                node.innerHTML = html;\r\n            } else if (langx.isArrayLike(html)) {\r\n                for (var i = 0; i < html.length; i++) {\r\n                    node.appendChild(html[i]);\r\n                }\r\n            } else {\r\n                node.appendChild(html);\r\n            }\r\n\r\n            return this;\r\n        }\r\n    }\r\n\r\n\r\n    function html(node,value) {\r\n        var result = _html(node,value);\r\n\r\n        if (value !== undefined) {\r\n            var scripts = node.querySelectorAll('script');\r\n\r\n            for (var i =0; i<scripts.length; i++) {\r\n                var node1 = scripts[i];\r\n                if (rscriptType.test( node1.type || \"\" ) ) {\r\n                  scripter.evaluate(node1.textContent,node1);\r\n                }\r\n            }       \r\n            return this;         \r\n        } else {\r\n            return result;\r\n        }\r\n    }\r\n\r\n    /*   \r\n     * Check to see if a dom node is a descendant of another dom node.\r\n     * @param {Node} node\r\n     * @param {Node} parent\r\n     * @param {Node} directly\r\n     */\r\n    function isChildOf(node, parent, directly) {\r\n        if (directly) {\r\n            return node.parentNode === parent;\r\n        }\r\n        if (document.documentElement.contains) {\r\n            return parent.contains(node);\r\n        }\r\n        while (node) {\r\n            if (parent === node) {\r\n                return true;\r\n            }\r\n\r\n            node = node.parentNode;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /*   \r\n     * Check to see if a dom node is a document.\r\n     * @param {Node} node\r\n     */\r\n    function isDocument(node) {\r\n        return node != null && node.nodeType == node.DOCUMENT_NODE\r\n    }\r\n\r\n    /*   \r\n     * Check to see if a dom node is in the document\r\n     * @param {Node} node\r\n     */\r\n    function isInDocument(node) {\r\n      return (node === document.body) ? true : document.body.contains(node);\r\n    }        \r\n\r\n    var blockNodes = [\"div\", \"p\", \"ul\", \"ol\", \"li\", \"blockquote\", \"hr\", \"pre\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"table\"];\r\n\r\n    function isBlockNode(node) {\r\n        if (!node || node.nodeType === 3) {\r\n          return false;\r\n        }\r\n        return new RegExp(\"^(\" + (blockNodes.join('|')) + \")$\").test(node.nodeName.toLowerCase());\r\n    }\r\n\r\n    function isActive (elem) {\r\n            return elem === document.activeElement && (elem.type || elem.href);\r\n    }\r\n\r\n\r\n    function isTextNode(node) {\r\n        return node && node.nodeType === 3;\r\n    }\r\n\r\n\r\n    function isElement(node) {\r\n        return node && node.nodeType === 1;\r\n    }\r\n\r\n    function isInFrame() {\r\n        try {\r\n            return window.parent !== window.self;\r\n        } catch (x) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    /*   \r\n     * Get the owner document object for the specified element.\r\n     * @param {Node} elm\r\n     */\r\n    function ownerDoc(elm) {\r\n        if (!elm) {\r\n            return document;\r\n        }\r\n\r\n        if (elm.nodeType == 9) {\r\n            return elm;\r\n        }\r\n\r\n        return elm.ownerDocument;\r\n    }\r\n\r\n    /*   \r\n     *\r\n     * @param {Node} elm\r\n     */\r\n    function ownerWindow(elm) {\r\n        var doc = ownerDoc(elm);\r\n        return doc.defaultView || doc.parentWindow;\r\n    }\r\n\r\n    /*   \r\n     * insert one or more nodes as the first children of the specified node.\r\n     * @param {Node} node\r\n     * @param {Node or ArrayLike} placing\r\n     * @param {Boolean Optional} copyByClone\r\n     */\r\n    function prepend(node, placing, copyByClone) {\r\n        var parentNode = node,\r\n            refNode = parentNode.firstChild,\r\n            nodes = ensureNodes(placing, copyByClone);\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            if (refNode) {\r\n                parentNode.insertBefore(nodes[i], refNode);\r\n            } else {\r\n                parentNode.appendChild(nodes[i]);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /*   \r\n     *\r\n     * @param {Node} elm\r\n     */\r\n    function offsetParent(elm) {\r\n        var parent = elm.offsetParent || document.body;\r\n        while (parent && !rootNodeRE.test(parent.nodeName) && document.defaultView.getComputedStyle(parent).position == \"static\") {\r\n            parent = parent.offsetParent;\r\n        }\r\n        return parent;\r\n    }\r\n\r\n    /*   \r\n     * Remove the set of matched elements from the DOM.\r\n     * @param {Node} node\r\n     */\r\n    function remove(node) {\r\n        if (node && node.parentNode) {\r\n            try {\r\n                node.parentNode.removeChild(node);\r\n            } catch (e) {\r\n                console.warn(\"The node is already removed\", e);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    function removeChild(node,children) {\r\n        if (!langx.isArrayLike(children)) {\r\n            children = [children];\r\n        }\r\n        for (var i=0;i<children.length;i++) {\r\n            node.removeChild(children[i]);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    function scrollParent( elm, includeHidden ) {\r\n        var position = document.defaultView.getComputedStyle(elm).position,\r\n            excludeStaticParent = position === \"absolute\",\r\n            overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,\r\n            scrollParent = this.parents().filter( function() {\r\n                var parent = $( this );\r\n                if ( excludeStaticParent && parent.css( \"position\" ) === \"static\" ) {\r\n                    return false;\r\n                }\r\n                return overflowRegex.test( parent.css( \"overflow\" ) + parent.css( \"overflow-y\" ) +\r\n                    parent.css( \"overflow-x\" ) );\r\n            } ).eq( 0 );\r\n\r\n        return position === \"fixed\" || !scrollParent.length ?\r\n            $( this[ 0 ].ownerDocument || document ) :\r\n            scrollParent;\r\n    };\r\n\r\n\r\n    function reflow(elm) {\r\n        if (!elm) {\r\n          elm = document;\r\n        }\r\n        elm.offsetHeight;\r\n\r\n        return this;      \r\n    }\r\n\r\n    /*   \r\n     * Replace an old node with the specified node.\r\n     * @param {Node} node\r\n     * @param {Node} oldNode\r\n     */\r\n    function replace(node, oldNode) {\r\n        oldNode.parentNode.replaceChild(node, oldNode);\r\n        return this;\r\n    }\r\n\r\n\r\n    function selectable(elem, selectable) {\r\n        if (elem === undefined || elem.style === undefined)\r\n            return;\r\n        elem.onselectstart = selectable ? function () {\r\n            return false;\r\n        } : function () {\r\n        };\r\n        elem.style.MozUserSelect = selectable ? 'auto' : 'none';\r\n        elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\r\n        elem.unselectable = selectable ? 'on' : 'off';\r\n    }\r\n\r\n    /*   \r\n     * traverse the specified node and its descendants, perform the callback function on each\r\n     * @param {Node} node\r\n     * @param {Function} fn\r\n     */\r\n    function traverse(node, fn) {\r\n        fn(node)\r\n        for (var i = 0, len = node.childNodes.length; i < len; i++) {\r\n            traverse(node.childNodes[i], fn);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /*   \r\n     *\r\n     * @param {Node} node\r\n     */\r\n    function reverse(node) {\r\n        var firstChild = node.firstChild;\r\n        for (var i = node.children.length - 1; i > 0; i--) {\r\n            if (i > 0) {\r\n                var child = node.children[i];\r\n                node.insertBefore(child, firstChild);\r\n            }\r\n        }\r\n    }\r\n\r\n    /*   \r\n     * Wrap an HTML structure around each element in the set of matched elements.\r\n     * @param {Node} node\r\n     * @param {Node} wrapperNode\r\n     */\r\n    function wrapper(node, wrapperNode) {\r\n        if (langx.isString(wrapperNode)) {\r\n            wrapperNode = this.createFragment(wrapperNode).firstChild;\r\n        }\r\n        node.parentNode.insertBefore(wrapperNode, node);\r\n        wrapperNode.appendChild(node);\r\n    }\r\n\r\n    /*   \r\n     * Wrap an HTML structure around the content of each element in the set of matched\r\n     * @param {Node} node\r\n     * @param {Node} wrapperNode\r\n     */\r\n    function wrapperInner(node, wrapperNode) {\r\n        var childNodes = slice.call(node.childNodes);\r\n        node.appendChild(wrapperNode);\r\n        for (var i = 0; i < childNodes.length; i++) {\r\n            wrapperNode.appendChild(childNodes[i]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /*   \r\n     * Remove the parents of the set of matched elements from the DOM, leaving the matched\r\n     * @param {Node} node\r\n     */\r\n    function unwrap(node) {\r\n        var child, parent = node.parentNode;\r\n        if (parent) {\r\n            if (this.isDoc(parent.parentNode)) return;\r\n            parent.parentNode.insertBefore(node, parent);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    function isInput (el) { \r\n        return el.tagName === 'INPUT' || \r\n               el.tagName === 'TEXTAREA' || \r\n               el.tagName === 'SELECT' || \r\n               isEditable(el); \r\n    }\r\n    \r\n    function isEditable (el) {\r\n      if (!el) { return false; } // no parents were editable\r\n      if (el.contentEditable === 'false') { return false; } // stop the lookup\r\n      if (el.contentEditable === 'true') { return true; } // found a contentEditable element in the chain\r\n      return isEditable(el.parentNode); // contentEditable is set to 'inherit'\r\n    }\r\n\r\n    function noder() {\r\n        return noder;\r\n    }\r\n\r\n    langx.mixin(noder, {\r\n        active  : activeElement,\r\n\r\n        after: after,\r\n\r\n        append: append,\r\n\r\n        before: before,\r\n\r\n        blur : function(el) {\r\n            el.blur();\r\n        },\r\n\r\n        body: function() {\r\n            return document.body;\r\n        },\r\n\r\n        clone: clone,\r\n\r\n        contains: contains,\r\n\r\n        contents: contents,\r\n\r\n        createElement: createElement,\r\n\r\n        createFragment: createFragment,\r\n\r\n        createTextNode: createTextNode,\r\n\r\n        doc: doc,\r\n\r\n        empty: empty,\r\n\r\n        generateId,\r\n\r\n        fullscreen: fullscreen,\r\n\r\n        focusable: focusable,\r\n\r\n        fromPoint,\r\n\r\n        html: html,\r\n\r\n        isActive,\r\n\r\n        isChildOf,\r\n\r\n        isDocument,\r\n\r\n        isEditable,\r\n        \r\n        isElement,\r\n\r\n        isFullscreen,\r\n\r\n        isInDocument,\r\n\r\n        isInFrame,\r\n\r\n        isInput,\r\n\r\n        isTextNode,\r\n\r\n        isWindow: langx.isWindow,\r\n\r\n        nodeName : nodeName,\r\n\r\n        offsetParent: offsetParent,\r\n\r\n        ownerDoc: ownerDoc,\r\n\r\n        ownerWindow: ownerWindow,\r\n\r\n        prepend: prepend,\r\n\r\n        reflow: reflow,\r\n\r\n        remove: remove,\r\n\r\n        removeChild : removeChild,\r\n\r\n        replace: replace,\r\n\r\n        selectable,\r\n\r\n        traverse: traverse,\r\n\r\n        reverse: reverse,\r\n\r\n        wrapper: wrapper,\r\n\r\n        wrapperInner: wrapperInner,\r\n\r\n        unwrap: unwrap\r\n    });\r\n\r\n    return skylark.attach(\"domx.noder\" , noder);\r\n});"]}